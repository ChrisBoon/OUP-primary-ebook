<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>requestAnimation</title>
  <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

<style>
body {
  margin:0;
}
#box {
  width: 100%;
  height: 800px;
  position: relative;
  background-color: black;
  /*box-shadow: 0 -1600px 1600px -1600px blue inset;*/
}
.point {
  height: 20px;
  width: 20px;
  position: absolute;
  background:  url('img/star.png') 0 0  no-repeat;
}
.point.green {
  background:  url('img/greenStar.png') 0 0  no-repeat;
}
.point.blue {
  background:  url('img/blueStar.png') 0 0  no-repeat;
}

</style>

</head>
<body>

  <div id="box"></div>


<script>

var $box = $("#box"),
    boxW = $box.width(),
    boxH = $box.height(),
    x0 = (boxW / 2),
    y0 = (boxH / 2),
    r = 10,
    items = 12,
    burstRadius = 100,
    increment = 3;
    theStars = ['', 'green', 'blue'],
    starsRotate = 0;

// shim layer with setTimeout fallback
window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame       ||
          window.msRequestAnimationFrame     ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          window.oRequestAnimationFrame      ||
          function( callback ){
            window.setTimeout(callback, 1000 / 60);
          };
})();

$box.click(function(e) {

  r = 10; // reset r to start point for each click

  // get click location
  x0 = e.pageX;
  y0 = e.pageY;

  // create the circles
  for(var i = 0; i < items; i++) {
      var x = ( x0 + r * Math.cos(2 * Math.PI * i / items) ) -10;
      var y = ( y0 + r * Math.sin(2 * Math.PI * i / items) ) -10;   
      $box.append("<div class='point' style='left:"+ x +"px;top:"+ y +"px'></div>");
  } // end for
  

  // store of the points so we can control them
  $circles = $("#box .point");
  $circles.addClass( theStars[starsRotate]);

  if (starsRotate == 2) {starsRotate = 0}
    else
    {starsRotate += 1}


  // trigger the animation
  (function animloop(){
    if (r < burstRadius) {
    requestAnimFrame(animloop);
    render();
    }
    else
    {
    $circles.remove(); // remove the points from the dom
    }
  })(); // end animloop

})  // end click function

// this does gthe actual manipulation of the stars
function render() {

  r += increment;

  $circles.each(function(i) {
      var x = ( x0 + r * Math.cos(2 * Math.PI * i / items) ) -10;
      var y = ( y0 + r * Math.sin(2 * Math.PI * i / items) ) -10;   
      var opac = (1 - (r / 100));
      $(this).css('left', x).css('top', y).css('opacity', opac);
  })

} // end render

</script>
</body>
</html>